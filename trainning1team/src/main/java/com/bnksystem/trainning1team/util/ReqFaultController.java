//package com.bnksystem.trainning1team.util;//////import com.bnksys.bnktoms.biz.service.DeviceIdService;////import com.bnksys.bnktoms.biz.service.PushNotificationsService;////import com.bnksys.bnktoms.biz.service.ReqFaultService;////import com.bnksys.bnktoms.common.*;////import com.bnksys.bnktoms.common.notification.FCMService;////import org.slf4j.Logger;////import org.slf4j.LoggerFactory;////import org.springframework.beans.factory.annotation.Autowired;////import org.springframework.stereotype.Controller;////import org.springframework.web.bind.annotation.*;////////import javax.servlet.http.HttpServletResponse;////import java.util.ArrayList;////import java.util.HashMap;////import java.util.List;////import java.util.Map;////import java.util.concurrent.ExecutorService;////import java.util.concurrent.Executors;////import java.util.concurrent.Future;////////@Controller////@RequestMapping("/fault")////public class ReqFaultController {////    private Logger logger = LoggerFactory.getLogger(getClass().getSimpleName());////////    @Autowired////    private ReqFaultService service;////    @Autowired////    private DeviceIdService deviceIdService;////    @Autowired////    private PushNotificationsService pushNotificationsService;////    @Autowired////    private FCMService fcmService;////////    @PostMapping("/getList")////    public @ResponseBody String getList(@RequestBody HashMap<String, Object> parameters) {////        Result result = new Result("RSLT0000", "SUCCESS");////        List<HashMap<String, Object>> list = new ArrayList<HashMap<String, Object>>();////////        try {////////            int page = (int) parameters.get("PAGE");////            int perPage = (int) parameters.get("PER_PAGE");////////            int offset = (page - 1) * perPage;////////            parameters.put("OFFSET", offset);////////            int totalCount = service.getReqFaultListCount(parameters);////////            int pageCount = totalCount / perPage;////            if (totalCount % perPage > 0) {////                pageCount++;////            }////////            list = service.getReqFaultList(parameters);////////            HashMap<String, Object> dataMap = new HashMap<>();////            dataMap.put("list", list);////            dataMap.put("pageCount", pageCount);////            dataMap.put("totalCount", totalCount);////////            result = new Result("RSLT0000", "SUCCESS", dataMap);////////        }////        catch (Exception e) {////            result = new Result("RSLT9999", e.getLocalizedMessage());////            logger.error(ExceptionUtils.getStackTrace(e));////        }////////        return result.toJson();////    }////////    @PostMapping("/getListAll")////    public @ResponseBody String getListAll(@RequestBody HashMap<String, Object> parameters) {////        Result result = new Result("RSLT0000", "SUCCESS");////        List<HashMap<String, Object>> list = new ArrayList<HashMap<String, Object>>();////////        try {////////            list = service.getReqFaultListAll(parameters);////////            HashMap<String, Object> dataMap = new HashMap<>();////            dataMap.put("list", list);////////            result = new Result("RSLT0000", "SUCCESS", dataMap);////////        }////        catch (Exception e) {////            result = new Result("RSLT9999", e.getLocalizedMessage());////            logger.error(ExceptionUtils.getStackTrace(e));////        }////////        return result.toJson();////    }////////    @PostMapping("/getInfo")////    public @ResponseBody String getInfo(@RequestBody HashMap<String, Object> parameters) {////        Result result = new Result("RSLT0000", "SUCCESS");////        List<HashMap<String, Object>> list = new ArrayList<HashMap<String, Object>>();////////        try {////////            HashMap<String, Object> info = service.getReqFaultInfo(parameters);////////            if (info != null && info.size() > 0) {////                result = new Result("RSLT0000", "SUCCESS", info);////            } else {////                result = new Result("RSLT8888", "일치하는 정보가 존재하지 않습니다.");////            }////////        }////        catch (Exception e) {////            result = new Result("RSLT9999", e.getLocalizedMessage());////            logger.error(ExceptionUtils.getStackTrace(e));////        }////////        return result.toJson();////    }////////    @PostMapping("/addReqFaultInfo")////    public @ResponseBody String addReqFaultInfo(@RequestBody HashMap<String, Object> parameters, @SessionAttribute("userMap") HashMap<String, Object> userMap) {////        Result result = new Result("RSLT0000", "SUCCESS");////        List<HashMap<String, Object>> list = new ArrayList<HashMap<String, Object>>();////////        try {////////            parameters.put("REG_ID", String.valueOf(userMap.get("emp_id")));////            int successCnt = service.createReqFaultInfo(parameters);////////            if (successCnt <= 0) {////                result = new Result("RSLT8888", "Failed");////            } else {////                HashMap<String, Object> info = service.getReqFaultInfoFromReqNo(parameters);//////              조치예정자에게만 push 전송////                List<HashMap<String, Object>> tokens = deviceIdService.getDeviceIdListPreActor(parameters);////////                if (tokens != null && !tokens.isEmpty()) {////////                    for (HashMap<String, Object> token: tokens) {////////                        if (!StringUtils.isEmptyOrNull((String) token.get("push_token"))) {////                            String message = "신규 장애사항이 등록되었습니다.";////                            HashMap<String, Object> payload = new HashMap<>();////                            payload.put("title", "장애 처리 알림");////                            payload.put("message", message);////////                            Map<String, String> body = new HashMap<>();////                            body.put("type", "REQ");////                            body.put("message", message);////////                            String linkUrl = info != null && !info.isEmpty() ? "/mobile/getReqFaultInfoMobile/" + parameters.get("ID") : "";////////                            body.put("linkUrl", linkUrl);////                            body.put("emp_id", token.get("emp_id").toString());////                            body.put("token", token.get("push_token").toString());////////                            ExecutorService executorService = Executors.newFixedThreadPool(10);////////                            Future<?> future = executorService.submit(() -> fcmService.send((String) token.get("push_token"), payload, body));////////                            try {////                                future.get();////                                logger.debug("Send completed!!");////                            } catch (Exception e) {////                                logger.error(ExceptionUtils.getStackTrace(e));////                            }////////                            executorService.shutdown();////////                            HashMap<String, Object> params = new HashMap<>();////                            params.put("EMP_ID", token.get("emp_id"));////                            params.put("TITLE", payload.get("title"));////                            params.put("CONTENTS", message);////                            params.put("PUSH_TOKEN", token.get("push_token"));////                            params.put("PAYLOAD", body.toString());////////                            pushNotificationsService.createPushNotificationsInfo(params);////                        }////                    }////                }////            }////////        }////        catch (Exception e) {////            result = new Result("RSLT9999", e.getLocalizedMessage());////            logger.error(ExceptionUtils.getStackTrace(e));////        }////////        return result.toJson();////    }////////    @PostMapping("/modReqFaultInfo")////    public @ResponseBody String modReqFaultInfo(@RequestBody HashMap<String, Object> parameters, @SessionAttribute("userMap") HashMap<String, Object> userMap) {////        Result result = new Result("RSLT0000", "SUCCESS");////        List<HashMap<String, Object>> list = new ArrayList<HashMap<String, Object>>();////////        try {////            parameters.put("UPD_ID", String.valueOf(userMap.get("emp_id")));////            int successCnt = service.modifyReqFaultInfo(parameters);////////            if (successCnt <= 0) {////                result = new Result("RSLT8888", "Failed");////            }////////        }////        catch (Exception e) {////            result = new Result("RSLT9999", e.getLocalizedMessage());////            logger.error(ExceptionUtils.getStackTrace(e));////        }////////        return result.toJson();////    }////////    @PostMapping("/addReqFaultActInfo")////    public @ResponseBody String addReqFaultActInfo(@RequestBody HashMap<String, Object> parameters, @SessionAttribute("userMap") HashMap<String, Object> userMap) {////        Result result = new Result("RSLT0000", "SUCCESS");////        List<HashMap<String, Object>> list = new ArrayList<HashMap<String, Object>>();////////        try {////////            parameters.put("UPD_ID", String.valueOf(userMap.get("emp_id")));////            int successCnt = service.createReqFaultActInfo(parameters);////////            if (successCnt <= 0) {////                result = new Result("RSLT8888", "Failed");////            } else {////                HashMap<String, Object> info = service.getReqFaultInfo(parameters);////                List<HashMap<String, Object>> tokens = deviceIdService.getDeviceIdListAll(new HashMap<>());////////                if (tokens != null && !tokens.isEmpty()) {////////                    for (HashMap<String, Object> token: tokens) {////////                        if (!StringUtils.isEmptyOrNull((String) token.get("push_token"))) {////                            String message = "접수번호[" + info.get("req_no") + "]에 대한 처리 정보가 등록되었습니다.";////////                            HashMap<String, Object> payload = new HashMap<>();////                            payload.put("title", "장애 처리 알림");////                            payload.put("message", message);////////                            Map<String, String> body = new HashMap<>();////                            body.put("type", "REQ");////                            body.put("message", message);////////                            String linkUrl = info != null && !info.isEmpty() ? "/mobile/getReqFaultInfoMobile/" + parameters.get("ID") : "";////////                            body.put("linkUrl", linkUrl);////                            body.put("emp_id", token.get("emp_id").toString());////                            body.put("token", token.get("push_token").toString());////////                            ExecutorService executorService = Executors.newFixedThreadPool(10);////////                            Future<?> future = executorService.submit(() -> fcmService.send((String) token.get("push_token"), payload, body));////////                            try {////                                future.get();////                                logger.debug("Send completed!!");////                            } catch (Exception e) {////                                logger.error(ExceptionUtils.getStackTrace(e));////                            }////////                            executorService.shutdown();////////                            HashMap<String, Object> params = new HashMap<>();////                            params.put("EMP_ID", token.get("emp_id"));////                            params.put("TITLE", payload.get("title"));////                            params.put("CONTENTS", message);////                            params.put("PUSH_TOKEN", token.get("push_token"));////                            params.put("PAYLOAD", body.toString());////////                            pushNotificationsService.createPushNotificationsInfo(params);////                        }////                    }////                }////            }////////        }////        catch (Exception e) {////            result = new Result("RSLT9999", e.getLocalizedMessage());////            logger.error(ExceptionUtils.getStackTrace(e));////        }////////        return result.toJson();////    }////////    @PostMapping("/delReqFaultInfo")////    public @ResponseBody String delReqFaultInfo(@RequestBody HashMap<String, Object> parameters, @SessionAttribute("userMap") HashMap<String, Object> userMap) {////        Result result = new Result("RSLT0000", "SUCCESS");////        List<HashMap<String, Object>> list = new ArrayList<HashMap<String, Object>>();////////        try {////////            parameters.put("UPD_ID", String.valueOf(userMap.get("emp_id")));////            int successCnt = service.removeReqFaultInfo(parameters);////////            if (successCnt <= 0) {////                result = new Result("RSLT8888", "Failed");////            }////////        }////        catch (Exception e) {////            result = new Result("RSLT9999", e.getLocalizedMessage());////            logger.error(ExceptionUtils.getStackTrace(e));////        }////////        return result.toJson();////    }////    // 엑셀////    @PostMapping("/excelReqFaultList")////    public void excelReqFaultList(HttpServletResponse response, @RequestBody HashMap<String, Object> parameters, @SessionAttribute("userMap") HashMap<String, Object> userMap) throws Exception {////////        String[] header = new String[]{"번호", "장애번호", "접수일", "계열사", "부실점명", "직위", "담당자", "기기명", "조치결과", "조치일", "조치자"};////        Integer[] contentSize = new Integer[]{2000, 6000, 4000, 4000, 4000, 4000, 4000, 4000, 4000, 4000, 4000};////        String[] content = new String[] { "", "req_no", "req_dt", "comp_nm", "dept_nm", "emp_rank", "emp_nm", "device_cd_nm", "act_result_nm", "act_dt", "actor_nm"};////        String fileName = "ReqFault";////////        List<HashMap<String, Object>> processList = service.getReqFaultListAll(parameters);////////        ExcelUtils.getInstance(ExcelType.XLSX).getExcel(header, contentSize, content, fileName, processList, response);////////    }////}//